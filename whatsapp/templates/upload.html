
<!DOCTYPE html>
<html>
<head>
    <title>Upload Syllabus and Question</title>
</head>
<body>
    <h1>Upload Files</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <p>
            <label>Choose existing syllabus or upload new:</label><br>
            <select name="existing_syllabus">
                <option value="">-- Upload new syllabus --</option>
                {% for syllabus in syllabi %}
                    <option value="{{ syllabus.id }}">{{ syllabus.file.name }} ({{ syllabus.uploaded_at|date:"Y-m-d H:i" }})</option>
                {% endfor %}
            </select>
        </p>
        <p>
            <label>Or upload new syllabus:</label>
            <input type="file" name="syllabus">
        </p>
        <p>
            <label>Question Image:</label>
            <input type="file" name="question" accept="image/*" id="fileInput" required>
            <div id="pasteArea" style="border: 2px dashed #ccc; padding: 20px; margin: 10px 0; text-align: center; cursor: pointer;">
                Click here or paste image (Ctrl+V)
            </div>
            <img id="previewImage" style="max-width: 300px; display: none; margin-top: 10px;">
        </p>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const pasteArea = document.getElementById('pasteArea');
                const fileInput = document.getElementById('fileInput');
                const previewImage = document.getElementById('previewImage');

                // Handle paste events
                document.addEventListener('paste', function(e) {
                    const items = e.clipboardData.items;
                    for (let item of items) {
                        if (item.type.indexOf('image') !== -1) {
                            const file = item.getAsFile();
                            const dt = new DataTransfer();
                            dt.items.add(file);
                            fileInput.files = dt.files;
                            previewImage.src = URL.createObjectURL(file);
                            previewImage.style.display = 'block';
                            break;
                        }
                    }
                });

                // Handle file input change
                fileInput.addEventListener('change', function() {
                    if (this.files && this.files[0]) {
                        previewImage.src = URL.createObjectURL(this.files[0]);
                        previewImage.style.display = 'block';
                    }
                });

                // Make paste area clickable
                pasteArea.addEventListener('click', function() {
                    fileInput.click();
                });
            });
        </script>
        <p>
            <label>Custom Prompt (Optional):</label><br>
            <textarea name="prompt" rows="4" cols="50" placeholder="Extract and answer the question from this image based on the syllabus content"></textarea>
        </p>
        <button type="submit">Process</button>
    </form>
    <p><a href="{% url 'history' %}">View History</a></p>
</body>
</html>
